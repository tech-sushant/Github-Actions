name: "Test GH CLI PR Fetch"

on:
  workflow_dispatch:

jobs:
  test-gh-pr-fetch:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout Code
        uses: actions/checkout@v2

      - name: Check GitHub CLI version
        run: gh --version

      - name: Get latest two tags
        id: tags
        run: |
          TAGS=($(git tag --sort=-creatordate | head -n 2))
          echo "latest_tag=${TAGS[0]}" >> $GITHUB_OUTPUT
          echo "previous_tag=${TAGS[1]}" >> $GITHUB_OUTPUT

      - name: Fetch merged PRs between tags
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          echo "Fetching PRs between ${{ steps.tags.outputs.previous_tag }} and ${{ steps.tags.outputs.latest_tag }}"

          gh pr list --state merged --search "${{ steps.tags.outputs.previous_tag }}..${{ steps.tags.outputs.latest_tag }}" --json title,number --jq '.[] | "- PR #" + (.number|tostring) + ": " + .title'
